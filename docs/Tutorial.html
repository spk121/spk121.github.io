<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- Copyright (C) 2018, 2019, 2020 Michael L. Gran

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is included in the section entitled "GNU
Free Documentation License". -->
<title>Tutorial (Guile-GI)</title>

<meta name="description" content="Tutorial (Guile-GI)">
<meta name="keywords" content="Tutorial (Guile-GI)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="The-Index.html" rel="index" title="The Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html" rel="up" title="Top">
<link href="Reference-Guide.html#Reference-Guide" rel="next" title="Reference Guide">
<link href="Introduction.html#Introduction" rel="prev" title="Introduction">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="document-1.0.1.css">


</head>

<body lang="en">
<div class="chapter" id="Tutorial">
<div class="header">
<p>
Next: <a href="Reference-Guide.html#Reference-Guide" accesskey="n" rel="next">Reference Guide</a>, Previous: <a href="Introduction.html#Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="index.html" accesskey="u" rel="up">Guile-GI</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="The-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Tutorial-1"></span><h2 class="chapter">2 Tutorial</h2>


<hr>
<div class="section" id="Parsing-Typelibs-and-Creating-Bindings">
<span id="Parsing-Typelibs-and-Creating-Bindings-1"></span><h3 class="section">2.1 Parsing Typelibs and Creating Bindings</h3>

<p>When Guile-GI is used, it creates procedures, variables, and types
according to the instructions in the <code>typelib</code> files.  These are
created <em>at runtime</em> as Guile loads them from the <code>typelib</code>
file.
</p>
<p>To create the bindings, you must load a typelib through Guile-GI in one
form or another.  You can choose one of three basic strategies.
</p>
<div class="subsection" id="use_002dtypelibs">
<h4 class="subsection">2.1.1 <code>use-typelibs</code></h4>

<p>The easiest way of doing so is <code>use-typelibs</code>, as shown below.
</p>
<div class="example">
<pre class="example">(use-modules (gi))
(use-typelibs (&quot;GLib&quot; &quot;2.0&quot;) (&quot;Gtk&quot; &quot;3.0&quot;))
</pre></div>

<p><code>use-typelibs</code> works quite similar to <code>use-modules</code> and is in
fact implemented in terms of it. The only difference in syntax is, that
instead of a list of symbols describing a module, you have a list of
exactly two strings, the first being the name of the typelib and the
second being the version.
</p>
<p>Semantically, however, the difference to <code>use-modules</code> is bigger.
Internally, Guile-GI creates modules for the typelibs as needed &ndash; in
this example these modules would be <code>(%gi GLib-2.0)</code> and <code>(%gi
Gtk-3.0)</code> &ndash; and loads the entire typelib into them.
</p>
<p>This approach has two major drawbacks.
</p><ol>
<li> Guile-GI has to load the entire typelib. For large typelibs, such as
GTK, this takes a lot of time.

</li><li> Even though Guile-GI internally uses modules, these modules are not
available to the user in any meaningful way.  Even another
<code>use-modules</code> on them actually leads to undefined behaviour.  It
may load the module if it has already been defined somewhere else, but
it might also throw an error, claiming that no code for the module could
be found.  This is to be expected, given that the modules are not backed
by actual files.
</li></ol>

<p><code>use-typelibs</code> is a simple interface for Guile scripts not broken
into multiple modules.
</p>
</div>
<div class="subsection" id="require-and-load_002dby_002dname">
<h4 class="subsection">2.1.2 <code>require</code> and <code>load-by-name</code></h4>

<p>For efficiency&rsquo;s sake, you may want to only load parts, e.g. just
GtkApplication and GtkWindow to significantly speed up loading.  By
targeted use of <code>require</code> and <code>load-by-name</code>, you can load
only the procedures you intend to use.  <code>(gi repository)</code> has
primitives to facilitate exactly that. See <a href="Reference-Guide.html#Typelib-Introspection">Typelib Introspection</a>.
</p><div class="example">
<pre class="example">(define-module (doc ex-load-by-name)
  #:use-module (gi)
  #:use-module (gi repository))
(require &quot;GLib&quot; &quot;2.0&quot;)
(load-by-name &quot;GLib&quot; &quot;MainLoop&quot;)
(load-by-name &quot;GLib&quot; &quot;MainContext&quot;)
(export &lt;GMainLoop&gt;
        main-loop:new
        is-running?
        &lt;GMainContext&gt;
        get-context)
</pre></div>

</div>
<div class="subsection" id="typelib_002d_003emodule">
<h4 class="subsection">2.1.3 <code>typelib-&gt;module</code></h4>

<p>If you don&rsquo;t care much about waiting times &ndash; perhaps you only have
a set of small dependencies, or you really need everything from a library &ndash;
but you need the ability to refer to a module specifically through
<code>use-modules</code>, you will have to provide your own module.
However, writing all the <code>require</code> and <code>load-by-name</code>s when you
don&rsquo;t care about granularity is tedious and error-prone.
</p>
<p>As a convenience <code>(gi repository)</code> also contains <code>typelib-&gt;module</code>.
This procedure loads a typelib into the current module and also adds all
functionality loaded in the process to the public inferface.
</p><div class="example">
<pre class="example">(define-module (gi gtk-3)
  #:use-module (gi)
  #:use-module (gi repository))

(typelib-&gt;module (current-module) &quot;Gtk&quot; &quot;3.0&quot;)

;; additional code you might want to add and export
</pre></div>
<p>You may use it to create one such module per dependency, or one module for all
dependencies.  Together with Guile&rsquo;s module system, you can even do some
advanced operations, like loading all of Gtk under the prefix <code>gtk::</code>
together with all of Gstreamer under the prefix <code>gst::</code>.
See <a data-manual="guile" href="https://www.gnu.org/software/guile/manual/html_node/Modules.html#Modules">Modules</a> in <cite>The Guile reference manual</cite>.
</p>
<hr>
</div>
</div>
<div class="section" id="Generating-Documentation-from-Typelibs">
<span id="Generating-Documentation-from-Typelibs-1"></span><h3 class="section">2.2 Generating Documentation from Typelibs</h3>

<p>Loading typelibs alone might be all you need if you have perfect
knowledge of all the libraries you are going to use and an intuitive
understanding of how they are mapped to Scheme procedures.  Chances are,
however, that you do not.  In this case, it might be useful to generate
some documentation. See <a href="Reference-Guide.html#Typelib-Documentation">Typelib Documentation</a>.
</p>
<p>Upon installation of Guile-GI, we install a script called
<code>gi-gtkdoc</code>, that can be invoked through <code>guild</code>.  Running the
script will create HTML documentation for a typelib file.
</p>
<p>You may also want to create a <samp>guile-procedures.txt</samp> file for use
in the REPL.  We currently have no script for that, but one can easily
be written.  The following for example exports all the documentation for
GObject-2.0.
</p>
<div class="example">
<pre class="example">#!/path/to/guile
!#
(use-modules (gi documentation))

(let ((%typelib (typelib &quot;GObject&quot; &quot;2.0&quot;))
      (%gir (false-if-exception (gir &quot;GObject&quot; &quot;2.0&quot;)))
      (%doc '()))
  (set! %doc (parse %typelib %doc))
  (close %typelib)
  (when %gir
    (set! %doc (parse %gir %doc))
    (close %gir))
  (-&gt;guile-procedures.txt %doc))
</pre></div>

<p>Use shell pipes to redirect the output into a file, preferably one
called &ldquo;guile-procedures.txt&rdquo;.  Guile will search for documentation in
such files in a few locations, including the current working directory.
</p>
<hr>
</div>
<div class="section" id="Categories-of-Typelib-Bindings">
<span id="Categories-of-Typelib-Bindings-1"></span><h3 class="section">2.3 Categories of Typelib Bindings</h3>

<p>Typelib files describe a few different types of information.  Here&rsquo;s a
quick introduction to the categories of information it provides, and how
Guile-GI creates bindings.
</p>

<hr>
<div class="subsection" id="Constants">
<span id="Constants-1"></span><h4 class="subsection">2.3.1 Constants</h4>

<p>On introspection, when a typelib file defines a constant, Guile-GI
creates a variable.  The variable name is in <code>MACRO_CASE</code>, capital
letters separated by underscores.  Note that the variables created are
not themselves constants: one could <code>set!</code> them to another value,
with likely detrimental effects.
</p>
<p>The names of the variables created will be the same as the native API,
with the namespace removed.
</p><div class="example">
<pre class="example">;; In C, the constant G_BIG_ENDIAN
BIG_ENDIAN
</pre></div>

<hr>
</div>
<div class="subsection" id="Flags-and-Enums">
<span id="Flags-and-Enums-1"></span><h4 class="subsection">2.3.2 Flags and Enums</h4>

<p>When a typelib file contains a set of flags or enums, Guile-GI creates a
class for that set.  That class contains an association map between
symbols and values.
</p>
<p>For example, when Guile-GI encounters the  <code>G_APPLICATION_FLAGS</code>
flags collection, it creates a GOOPS type <code>&lt;GApplicationFlags&gt;</code>.
Its association map can be queried two ways.
</p><div class="example">
<pre class="example">;; In C, (G_APPLICATION_HANDLES_OPEN | G_APPLICATION_NON_UNIQUE)
(list-&gt;flags &lt;GApplicationFlags&gt; '(handles-open non-unique))
(list-&gt;application-flags '(handles-open non-unique))
</pre></div>

<p>Enums are similar, except not accessed as lists.
</p><div class="example">
<pre class="example">;; In C, the enum G_BUS_TYPE_SYSTEM
(symbol-&gt;enum &lt;GBusType&gt; 'system)
(symbol-&gt;bus-type 'system)
</pre></div>

<hr>
</div>
<div class="subsection" id="Structs-and-Unions">
<span id="Structs-and-Unions-1"></span><h4 class="subsection">2.3.3 Structs and Unions</h4>

<p>In C, a <code>struct</code> or <code>union</code> is named type of a collection of
member objects.
</p>
<p>The unions and structs are handled in Guile-GI by creating a GOOPS type
that wraps a native pointer.  Typically, a library provides methods to
operate on structs and unions, and Guile-GI wraps those methods as GOOPS
generic functions.  If a typelib does not provide an explicit
constructor for a struct or union, an empty instance can be created by
using <code>make</code>.
</p>
<div class="example">
<pre class="example">(use-modules (gi))
(use-typelibs (&quot;GLib&quot; &quot;2.0&quot;))
;; Create a new empty &lt;GDate&gt; using 'make'
(write (make &lt;GDate&gt;))
(newline)
;; Create a new &lt;GDate&gt; using a constructor procedure
(define dt (date:new-dmy 1 (symbol-&gt;date-month 'january) 2000))
;; Modify the contents of &lt;GDate&gt;
(add-years dt 1)
;; Compute the resulting year
(write (get-year dt))
(newline)
</pre></div>

<hr>
</div>
<div class="subsection" id="GObjects">
<span id="GObjects-1"></span><h4 class="subsection">2.3.4 GObjects</h4>

<p>Some libraries use the GObject class system provided by GLib.  GLib
provides a complete, if idiosyncratic, class system written in C.  It
has features such as inheritance and a generic message-passing facility
it calls <em>signals</em>.
</p>
<p>The GObjects are handled in Guile-GI by creating a GOOPS type that wraps
a native pointer.  On the GOOPS side, we try to create the same
inheritance hierarchy that the GObject classes use.  A library provides
methods to operate on object, and Guile-GI creates GOOPS generic
functions for those methods.
</p>
<p>Object instances usually will have parameters that can be queried and
modified. If a typelib does not provide an explicit constructor for an
object, an empty instance can be created by using
<code>make</code>. <code>make</code> can also set the initial values of parameters
when the object is constructed
</p>
<div class="example">
<pre class="example">(use-modules (gi))
(use-typelibs (&quot;Gio&quot; &quot;2.0&quot;))
;; Create a new empty &lt;GApplication&gt; using 'make' setting the
;; application-id parameter
(write (make &lt;GApplication&gt; #:application-id &quot;org.test.test&quot;))
(newline)
;; Create a new &lt;GApplication&gt; using a constructor procedure
(define ga (application:new &quot;org.test.test2&quot;
                            (list-&gt;application-flags '(handles-open))))
;; Modify the flags parameter of &lt;GApplication&gt; via the set-flags
;; method
(set-flags ga (list-&gt;application-flags '(non-unique)))
;; Query if it is running
(write (get-is-busy? ga))
(newline)
</pre></div>

<hr>
</div>
<div class="subsection" id="Procedures-and-Methods">
<span id="Procedures-and-Methods-1"></span><h4 class="subsection">2.3.5 Procedures and Methods</h4>

<p>When a library provides functions, they can either be standalone
functions or methods.  Methods are functions closely associated with a
type.
</p>
<p>When Guile-GI provides a binding for a stand-alone function, the
function name is the kebab-case version of the native function name,
with the namespace removed.
</p><div class="example">
<pre class="example">;; In C, the function g_unix_mount_at(mount_path, time_read)
(unix-mount-at mount-path)
</pre></div>

<p>When Guile-GI provides a binding for a method, it creates a GOOPS
generic function.  The function name is of the form
<code>type:method-name</code>.  It also provides an alias of the form
<code>method-name</code>.  Often, the generic functions using the shorter
method names end up overloaded; however, as they are bound to classes
they can usually be disambiguated based on their first arguments,
which are the object instances.
</p><div class="example">
<pre class="example">;; In C, the GDate* method g_date_add_days
;; The type:method form
(date:add-days date 1)
;; The method-only form
(add-days date 1)
</pre></div>

<blockquote>
<p><b>Caveat:</b> When loading multiple typelibs, it may happen, that the two define
classes with an identical name modulo namespace and a similar API.
We have already seen such an example with Gio and Gtk, both of which
have an application class.  Usually, though not always, one inherits from
the other.
</p>
<p>Even in this case, most methods can be disambiguated based on the object
instances.  The exception to this rule are static methods &ndash; like constructors &ndash;
which not only share the same name but often enough also have the same signature.
Such conflicts require manual resolution.
</p></blockquote>


<hr>
</div>
</div>
<div class="section" id="Argument-Conversion">
<span id="Argument-Conversion-1"></span><h3 class="section">2.4 Argument Conversion</h3>

<p>The bulk of Guile-GI is the code that converts Scheme function arguments
to and from from the native arguments and return values that a library
expects.  Guile-GI tries to do it in a predictable and unsurprising way,
but, the conversion from Scheme to native types has some mismatch.
</p>

<hr>
<div class="subsection" id="Function-Parameters-Arity-and-Return-Values">
<span id="Function-Parameters_002c-Arity_002c-and-Return-Values"></span><h4 class="subsection">2.4.1 Function Parameters, Arity, and Return Values</h4>
<span id="index-arity"></span>
<span id="index-return-values"></span>
<span id="index-function-parameters"></span>

<p>When using Guile-GI, the Scheme versions of introspected native
functions and callbacks will not always have the same number of input,
output, and return parameters as the native functions do.  The GObject
Introspection information designates the parameters to native functions
as either <em>in</em>, <em>in/out</em> or <em>out</em> parameters. The
<em>in/out</em> and <em>out</em> parameters are native pointers, so that the
C function may return data by reference.  To understand how they will
appear in the Scheme mapping, a few rules must be understood.
</p>
<p>The basic rules as follows:
</p><ul>
<li> If the native function has an input parameter, the Scheme binding will
have an input parameter.
</li><li> If the native function has a return value that is not <code>void</code>, the
Scheme binding will return a value.
</li><li> If the native function has an in/out parameter, the Scheme binding will
take an input parameter and return the output value.
</li><li> If the native function has an out parameter, the Scheme binding will not
have it as an input parameter but will return it as an output value.
</li></ul>

<p>By these rules, if the native function returns <code>void</code> and has no
<em>out</em> or <em>in/out</em> parameters, the return value of the Scheme
procedure is <code>*unspecified*</code>.
</p>
<p>If a native function returns a non-void value and has zero <em>out</em> or
<em>in/out</em> parameters, or if a native function returns <code>void</code>
and has a single <em>out</em> or <em>in/out</em> parameter, the Scheme
binding will return a value.
</p>
<p>Otherwise, the Scheme binding will return multiple values, as with the
Guile procedures <code>values</code> and <code>receive</code>.
</p>
<span id="index-values"></span>
<span id="index-receive"></span>

<div class="example">
<pre class="example">;; In C, the declaration of g_unix_mount_at is
;; GUnixMountEntry *g_unix_mount_at(const char *path,  /*in*/
;;                                  guint64 *time_read /*out*/)
(receive (mount-entry time-read)
    (unix-mount-at path))
</pre></div>

<hr>
</div>
<div class="subsection" id="Booleans">
<span id="Booleans-1"></span><h4 class="subsection">2.4.2 Booleans</h4>

<p>Guile booleans convert to native 0 and 1 boolean values.
</p>
<hr>
</div>
<div class="subsection" id="Characters">
<span id="Characters-1"></span><h4 class="subsection">2.4.3 Characters</h4>

<p>There are two native character types, the 1-byte <code>gchar</code> and the
4-byte <code>gunichar</code>.  The native 1-byte <code>gchar</code> character type
can represent many types of data, so understanding what a function wants
depends on context.  It could be a single-byte character in a specific
character encoding, a binary byte with no specific encoding, or an 8-bit
integer.  The native <code>gunichar</code> type always represents a Unicode
codepoint.
</p>
<p>When a 1-byte <code>gchar</code> is expected, if you pass a Guile character,
the presumption is that Latin-1 encoding is correct, e.g. if a Guile
character has codepoints U+0000 to U+00FF, it will be converted to a
1-byte integer and passed to the <code>gchar</code>.  A Guile integer can also
be passed when a native <code>gchar</code> is expected.
</p>
<p>When <code>gchar</code> is an output or return value, it is returned as an
integer because it is not possible to know what it is meant to
represent.
</p>
<hr>
</div>
<div class="subsection" id="Numbers">
<span id="Numbers-1"></span><h4 class="subsection">2.4.4 Numbers</h4>

<p>The conversion between Scheme and native integer arguments is direct,
but since Scheme integers can be any size, an overflow error can occur
when converting to native values.  Likewise Scheme floating-point values
are only 8-byte floats, so they can overflow when converting to a native
argument expecting a 4-byte float.
</p>
<hr>
</div>
<div class="subsection" id="Strings">
<span id="Strings-1"></span><h4 class="subsection">2.4.5 Strings</h4>

<p>Native strings are expected to be either in the locale encoding or in
UTF-8.  Guile strings are arrays of Unicode codepoints.
</p>
<p>GObject libraries usually use UTF-8 encoding for their strings, while
Guile uses a different encoding internally for its strings.  Thus
every time a string is parameter is passed through to a C procedure, a
new UTF-8 copy of the Guile string is created.  The string is
automatically freed when no longer in use.
</p>
<p>GObject has some procedures that deal with locale-encoded strings:
notably those procedures that deal with environment variables.
Guile-GI converts Guile strings to locale-encoded strings for those
procedures.  Note that this may throw an encoding error if the Guile
string cannot be represented in the current locale.
</p>
<hr>
</div>
<div class="subsection" id="Structs-Unions-and-Objects">
<span id="Structs_002c-Unions_002c-and-Objects"></span><h4 class="subsection">2.4.6 Structs, Unions, and Objects</h4>

<p>Guile-GI creates GOOPS types to represent native struct or object types,
and the GOOPS class wraps a native pointer to the object information.
When converting from Scheme to native, the pointer is extracted.  When
converting from native to Scheme, an instance of the GOOPS type is
created to hold the returned pointer.  Note that more than one Guile
instance can point to the same pointer.
</p>
<hr>
</div>
<div class="subsection" id="Native-Pointers">
<span id="Native-Pointers-1"></span><h4 class="subsection">2.4.7 Native Pointers</h4>

<p>Some procedures expect native void pointers.  For these arguments, you
can pass a Guile foreign pointer or a Guile bytevector.
</p>
<hr>
</div>
<div class="subsection" id="Arrays">
<span id="Arrays-1"></span><h4 class="subsection">2.4.8 Arrays</h4>

<p>There are many different types of native arrays, and the Guile types
expected for GObject procedures that native arrays varies depending on
the type required.
</p>
<p>Typically, for simple native arrays of numerical types &ndash; integers,
floating points, etc &ndash; a Guile bytevector needs to be used.  For these
bytevectors, always use native-endianness.
</p>
<p>When a native array of <code>gunichar</code> values is expected, a Guile
string can be used.
</p>
<p>When a native array of strings is expected, a Guile list or vector of
strings can be used.
</p>
<p>For native arrays of GObject objects, structs, unions, flags, enums, and
GTypes, a <em>list</em> is used instead of a bytevector.
</p>
<p>If the native procedure expects a zero-terminated array, Guile-GI will
provide that automatically.  There is no need to add you own zero.
</p>
<p>Some GObject procedures write output information into preallocated
arrays.  For those procedures, the Guile caller will need to create
and pass in a bytevector of the appropriate size.
</p>
<blockquote>
<p><b>Warning:</b> It is best not to use any of GLib&rsquo;s <code>Array</code> and <code>ByteArray</code>
procedures directly.  Since arrays get converted to bytevectors, these
procedures will likely fail to do anything sensible.
</p></blockquote>

<hr>
</div>
<div class="subsection" id="Null-Pointers-and-Optional-Arguments">
<span id="Null-Pointers-and-Optional-Arguments-1"></span><h4 class="subsection">2.4.9 Null Pointers and Optional Arguments</h4>

<p>If a native function has a pointer argument that can be NULL, the Guile
<code>#f</code> can be sent or received to indicate a null pointer.
</p>
<hr>
</div>
<div class="subsection" id="Hash-Tables-and-GHashTable-Types">
<span id="Hash-Tables-and-GHashTable-Types-1"></span><h4 class="subsection">2.4.10 Hash Tables and GHashTable Types</h4>

<p>One special case is that of GLib&rsquo;s <code>GHashTable</code> types.  The
guile-gi library converts native Guile hash tables to <code>GHashTable</code>
types as necessary when calling introspected native functions.  However,
marshalling Guile hash tables into <code>GHashTable</code> types and back
again has limitations.
</p>
<p>First, the keys of instances of <code>GHashTable</code> have a native type,
and only a few common key types are handled by guile-gi: integers, real
numbers, and strings can be converted.  All other types are treated as a
pointer, which may not be what is intended.
</p>
<p>Second, some introspected native functions modify instances of
<code>GHashTable</code> that are passed in as input arguments. The
modifications to an instance of <code>GHashTable</code> input will not be
reflected in the Guile hash tables from which is was created.
</p>
<hr>
</div>
</div>
<div class="section" id="Working-with-GObjects">
<span id="Working-with-GObjects-1"></span><h3 class="section">2.5 Working with GObjects</h3>
<span id="index-types"></span>

<p>GObject is GLib&rsquo;s class system.  It provides many of the facilities one
would expect for object-oriented programming in the context of GUIs.
</p>
<p>For each custom GObject type, Guile-GI creates a variable that holds
the GOOPS type.  That variable has the form <code>&lt;TYPE&gt;</code>,
where TYPE is the GObject type name. To check whether an object
has a given type, use the <code>is-a?</code> procedure found in GOOPS, which
Guile-GI re-exports.
</p>
<div class="example">
<pre class="example">(use-modules (gi))
(use-typelibs (&quot;GObject&quot; &quot;2.0&quot;) (&quot;Gio&quot; &quot;2.0&quot;))
(is-a? (make &lt;GApplication&gt;) &lt;GObject&gt;)
;; =&gt; #t
</pre></div>

<p>Each GObject struct, union, or object has a place in the GObject
single-inheritance class structure.  A <code>RadioButton</code> is a type of
<code>Button</code> is a type of <code>Widget</code>, for example.
</p>
<p>The native pointer is &ldquo;hidden&rdquo; inside a slot of the object.
If you need to access it, see <a href="Reference-Guide.html#Compatibility">Compatibility</a>.
</p>

<hr>
<div class="subsection" id="GType">
<span id="GType-1"></span><h4 class="subsection">2.5.1 GType</h4>
<span id="index-GType"></span>

<p>Every data type registered by The GLib Dynamic Type system has a unique
integer ID.  The integer ID is called the GType.  While GTypes are
usually a transparent detail, you will need to use them explicitly to
define new GObject parameters and signals.
</p>
<p>Guile-GI creates a special GOOPS type <code>&lt;GType&gt;</code> to hold these
integer IDs.  There are some function that operate on <code>&lt;GType&gt;</code>
integers that can be used to query information about the GObject class
structure.
This mapping is not complete, however.  Some datatypes on one end may have
several (valid) representations on the other.  This includes for instance
basic numeric types, which all map to some subtype of <code>&lt;number&gt;</code> with
no size indicator, since Guile expands numbers as needed.
</p>
<p>See <a href="Reference-Guide.html#GType-Constants-and-Operations">GType Constants and Operations</a>
</p>
<hr>
</div>
<div class="subsection" id="GObject-Methods">
<span id="GObject-Methods-1"></span><h4 class="subsection">2.5.2 GObject Methods</h4>
<span id="index-methods"></span>

<p>Guile-GI exports object methods as GOOPS methods in the formats
<code>type:method</code> and <code>method</code>, where <var>type</var> is the
class on which the method is defined and <var>method</var> is its
name.  Unbound methods (i.e. functions) are only bound to <code>method</code>.
</p>
<p>In either case, the following transformations are made to <var>type</var>
and <var>method</var>:
</p><ol>
<li> Both <var>type</var> and <var>method</var> are converted to <code>kebab-case</code>.
</li><li> If the method returns a boolean value and has no output arguments,
a <code>?</code> is appended to its name.
</li><li> If the method has an input, that is also marked as an output,
or a pre-allocated output, a <code>!</code> is appended to its name.
This comes from a Scheme naming convention for &ldquo;destructive&rdquo; functions &ndash;
i.e. functions, which may modify their inputs in-place.
</li></ol>

<p>Use whichever bindings you prefer or alternatively rename them using the
<code>#:rename</code> argument to <code>use-modules</code> or <code>use-typelibs</code>
respectively. Note that Guile currently warns if a binding is imported
from multiple libraries (e.g. both GLib and Gtk), but this should not
concern you in most cases, as both internally specialize the same
generic method.
</p>
<hr>
</div>
<div class="subsection" id="GObject-Signals">
<span id="GObject-Signals-1"></span><h4 class="subsection">2.5.3 GObject Signals</h4>
<span id="index-signals"></span>

<p>GObjects have a functionality for defining and calling callback
procedures that it calls <em>signals</em>.  Note that these signals have
nothing to do with Unix signals like <code>SIGTERM</code>.
</p>
<span id="index-connect"></span>
<p>To hook a callback procedure to an object&rsquo;s signal, use the
<code>connect</code> procedure. Consider the following example.
</p>
<div class="example">
<pre class="example">(define (activate app)
   ...
   )

(define activate-signal (make &lt;signal&gt; #:name &quot;activate&quot;))

(connect app              ; A GObject
         activate-signal  ; A &lt;signal&gt; object
         activate)        ; A procedure to call when emitted
</pre></div>

<p>In that example, the caller is attaching a procedure named
<code>activate</code> to the object <code>app</code>&rsquo;s &ldquo;activate&rdquo; signal.  When
the gobject object calls all the callback procedures attached to its
&ldquo;activate&rdquo; signal it will call this <code>activate</code> procedure.
</p>
<p>When a callback procedure is called it may receive some arguments
from the caller and some from user data.  In the example, <code>activate</code>
is supposed to take a single argument.
This argument &ndash; <code>app</code> &ndash; is supplied by the caller, as are all
arguments to signals.
</p>
<dl class="def">
<dt id="index-connect-1"><span class="category">Procedure: </span><span><strong>connect</strong> <em>obj (signal &lt;signal&gt;) (handler &lt;procedure&gt;) #:key after? detail</em><a href='#index-connect-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-connect-2"><span class="category">Procedure: </span><span><strong>connect</strong> <em>obj (signal &lt;signal&gt;) (detail &lt;symbol&gt;) (handler &lt;procedure&gt;) ...</em><a href='#index-connect-2' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-connect_002dafter"><span class="category">Procedure: </span><span><strong>connect-after</strong> <em>obj (signal &lt;signal&gt;) (handler &lt;procedure&gt;) ...</em><a href='#index-connect_002dafter' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-connect_002dafter-1"><span class="category">Procedure: </span><span><strong>connect-after</strong> <em>obj (signal &lt;signal&gt;) (detail &lt;symbol&gt;) (handler &lt;procedure&gt;) ...</em><a href='#index-connect_002dafter-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Hooks <var>handler</var> to emissions of <var>signal</var>.  If <var>detail</var> is
supplied, only emissions in which the detail matches it are considered.
</p>
<p><code>connect-after</code> works like <code>connect</code>, except that the handler
is run <em>after</em> the main handling code.  The same can be achieved by
setting <code>after?</code> to <code>#t</code>.
</p>
<p>Note, that <var>signal</var> may expect <var>handler</var> to have multiple output
arguments.  Each bit set in its <code>output-mask</code> corresponds to
one additional value in the output.
If the <code>return-type</code> is <code>G_TYPE_NONE</code>, the number of expected
outputs is the number of bits set in <code>output-mask</code>.  Otherwise,
an additional (first) value is required for the return value of the signal
itself.
</p></dd></dl>

<p>Signal objects can also be used to emit signals. Note that you shouldn&rsquo;t
normally do this when using objects of types that you did not define.
When using objects of types that you did define, you should only emit
the signals that you defined for that object (and perhaps the &ldquo;notify&rdquo;
signal when using explicit notification).
</p>
<dl class="def">
<dt id="index-_0028signal-_003csignal_003e_0029"><span class="category">Special Form: </span><span><strong><em>(signal &lt;signal&gt;)</em></strong> <em>obj [detail] [args...]</em><a href='#index-_0028signal-_003csignal_003e_0029' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Emits the <var>signal</var> signal of <var>obj</var> with <var>detail</var> and
<var>args</var>.  Note, that the interpretation of <var>detail</var> depends on
whether or not <var>signal</var> is detailed.  If it is, <var>detail</var> needs
to be a symbol, that will be translated to the detail of the emission.
If it is not, it is considered the first argument and will be consed
with <var>args</var> to form an argument list.
</p></dd></dl>

<p>Signals have several slots, that can be bound on creation time (and
reassigned freely, since they are proper GOOPS objects).  When
connecting signals, only <var>name</var> needs to be supplied.  When using
them as proper signals, at least <var>return-type</var> needs to be given as
well.
</p>
<dl class="def">
<dt id="index-name"><span class="category">Slot: </span><span><strong>name</strong><a href='#index-name' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The name of the signal.
A string.
</p></dd></dl>
<dl class="def">
<dt id="index-return_002dtype"><span class="category">Slot: </span><span><strong>return-type</strong><a href='#index-return_002dtype' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The return type of the signal.
A <code>&lt;GType&gt;</code> or integer, such as <code>G_TYPE_INT</code>.
</p></dd></dl>
<dl class="def">
<dt id="index-param_002dtypes"><span class="category">Slot: </span><span><strong>param-types</strong><a href='#index-param_002dtypes' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The parameter types of the signal.
A list of <code>&lt;GType&gt;</code>s or integers.
</p></dd></dl>
<dl class="def">
<dt id="index-accumulator"><span class="category">Slot: </span><span><strong>accumulator</strong><a href='#index-accumulator' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An optional signal accumulator procedure. See <a href="#Signal-Accumulators">Signal Accumulators</a>.
</p></dd></dl>
<dl class="def">
<dt id="index-flags"><span class="category">Slot: </span><span><strong>flags</strong><a href='#index-flags' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Signal flags, a logical or of one or more of
<code>SIGNAL_RUN_FIRST</code>, <code>SIGNAL_RUN_LAST</code>,
<code>SIGNAL_RUN_CLEANUP</code>, <code>SIGNAL_NO_RECURSE</code>, etc.
</p></dd></dl>
<dl class="def">
<dt id="index-output_002dmask"><span class="category">Slot: </span><span><strong>output-mask</strong><a href='#index-output_002dmask' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A bitmask, describing which argument should be returned to the user when
calling the signal as a procedure.
</p></dd></dl>


<hr>
<div class="subsubsection" id="Signal-Accumulators">
<span id="Signal-Accumulators-1"></span><h4 class="subsubsection">2.5.3.1 Signal Accumulators</h4>
<p>The signal accumulator is a special callback procedure that gets called
during a signal emission.  The &ldquo;accumulator&rdquo; nomenclature comes from
the common case where one wants to collect the return values of signal
emissions.  In Scheme terms, the accumulator can be compared to a
<code>fold</code> procedure that gets called on signal emission results.
</p>
<p>When specified, the signal accumulator is a procedure with two
input arguments: <var>seed</var> and <var>current</var>. The input value
<var>seed</var> is a value created by the previous call to the accumulator.
The first time the accumulator is called, <var>seed</var> will zero for
signals that return numeric types. The input value <var>current</var> is the
return value of the just emitted signal.
</p>
<p>The accumulator procedure should return zero, one, or two values.
</p><ul>
<li> If it produces no output value, signal handling continues for this
signal, and <var>seed</var> is left unchanged for the next call to the
accumulator.
</li><li> If it produces one output value, signal handling continues for this
signal, and, for the next call to the accumulator, the <var>seed</var> value
will be this output value.  Note that the output value must have the
same type as specified for the signal output value: <code>G_TYPE_INT</code>,
<code>G_TYPE_FLOAT</code>, etc.
</li><li> If it produces two output values, <var>seed</var> is set to the second output
value, and signal handling stops for this signal if the first output
value is <code>#f</code>.
</li></ul>
<p>If at any time <var>seed</var> would be set to an incorrect value or more
than two values are returned signal handling is aborted.
</p>
<hr>
</div>
</div>
<div class="subsection" id="GObject-Properties">
<span id="GObject-Properties-1"></span><h4 class="subsection">2.5.4 GObject Properties</h4>

<p>GObject objects may have one or more properties, which are variables
attached to the object that may be gotten or set.  GObject properties
usually have C-like types.  Remember that GObject objects are instances
of a class that may have a parent class, and each parent class may one
or more properties. So, for example, if the object is a radio button,
you may get or set properties that apply specifically to radio buttons,
or generic buttons, or generic widgets.
</p>
<span id="index-_003cGParam_003e"></span>

<p>In Guile-GI, properties come in two flavours.  The basic building block
are objects derived from <code>G_TYPE_PARAM</code> alias <code>&lt;GParam&gt;</code>.
These can be created via introspected methods found in the
<code>GObject</code> library.  They are enhanced so that they can work as
procedures with setter.  Given an arbitrary property <code>prop</code>,
<code>(prop obj)</code> will fetch the corresponding property, whereas
<code>(set! (prop obj) val)</code> will set it.
</p>
<p>The other flavour are GOOPS accessors.  These are used for introspected
properties, so that the name may also overlap with a method or a signal
of a different type. Other than that, they behave no different from
<code>&lt;GParam&gt;</code>s &ndash; in fact, they work by constructing a <code>&lt;GParam&gt;</code>
and using their getters and setters.
</p>
<hr>
</div>
<div class="subsection" id="Custom-GObjects">
<span id="Defining-new-GObject-classes"></span><h4 class="subsection">2.5.5 Defining new GObject classes</h4>
<span id="index-GObjects"></span>
<span id="index-classes_002c-GObject"></span>

<span id="index-register_002dtype"></span>
<p>Usually any GObjects you use will be created by procedures such as
<code>window:new</code>, and those GObject types will have been predefined in
the typelib. But, it is possible to make custom GObject object classes
using the <code>register-type</code> procedure.
</p>
<p>Bear in mind, that while Guile-GI internally uses GOOPS, GObjects
implemented in it are not quite as flexible. For instance, you cannot
meaningfully redefine a GObject-based type, which you could if you just
used GOOPS types.  On the other hand, you can make use of the features
of the GObject infrastructure, such as signals.
</p>
<p>Defining a new GObject class is rather complicated.
</p>
<dl class="def">
<dt id="index-register_002dtype-1"><span class="category">Procedure: </span><span><strong>register-type</strong> <em>type-name parent-type [list-of-properties] [list-of-signals]</em><a href='#index-register_002dtype-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure creates and returns a new <code>&lt;GType&gt;</code> of a GObject
object.
</p>
<p><var>type-name</var> is the string name of the new type. Note, that it will
be turned into a symbol internally.
</p>
<p><var>parent-type</var> is the <code>&lt;GType&gt;</code> of the parent class to this
class.  The parent class needs to be <code>&lt;GObject&gt;</code> or a GObject class
that descends from it.
</p>
<p><var>list-of-properties</var> is a list of parameter specifications.  These
parameter specifications can be created using the <code>param-spec-TYPE</code>
methods found in the <code>GObject</code> typelib.
</p>
<p><var>list-of-signals</var> is a list of signal specifications. See <a href="#GObject-Signals">GObject Signals</a>.
</p></dd></dl>

<p>To then make instances of your custom GObject type, use <code>make</code>.
</p>
<hr>
</div>
</div>
<div class="section" id="Sample-Applications">
<span id="Sample-Applications-1"></span><h3 class="section">2.6 Sample Applications</h3>

<p>If you&rsquo;ve managed to survive the tutorial thus far, you know should know
everything you need to start programming with Guile-GI.  Let&rsquo;s throw
down some examples.
</p>

<hr>
<div class="subsection" id="Window-with-Button">
<span id="Window-with-Button-1"></span><h4 class="subsection">2.6.1 Window with Button</h4>
<p>We will demonstrate the capabilities of Guile-GI by creating
a window with a button.  There are two version of the same script, so
that we can demonstrate different ways of doing things.
</p>
<p>In this first version, we use <code>use-typelibs</code> to load the bindings,
and we largely stick to using methods.
</p>
<div class="example">
<pre class="example">(use-modules (gi) (gi types) (gi util))

;; We're going to be creating many GOOPS generic functions
;; once we load up the typelibs.  We want the same-named
;; GOOPS generic functions to merge: we don't want the
;; generic functions from one type to overwrite a previous
;; class's generic functions.
(push-duplicate-handler! 'merge-generics)

;; Here we parse the typelib files to dynamically create our
;; types, classes and procedures.
;; Gio's application:new and Gtk's application:new take the
;; same argument types, so their GOOPS generics are easy to
;; confuse. We rename Gio's application:new for safety.
(use-typelibs ((&quot;Gio&quot; &quot;2.0&quot;) #:renamer (protect 'application:new))
              (&quot;Gtk&quot; &quot;3.0&quot;))

;; This is a callback we install to print a console message on the
;; receipt of the `clicked' signal.
(define (print-hello widget)
  (display &quot;Hello World\n&quot;))

;; This is the callback we install to handle the `activate'
;; signal that a &lt;GApplication&gt; may receive.
(define (activate-callback app)

  ;; Create a &lt;GtkApplicationWindow&gt; for this
  ;; &lt;GtkApplication&gt;, plus a button.
  (let* ((window (application-window:new app))
         (button-box (button-box:new
                      (symbol-&gt;orientation 'vertical)))
         (button (button:new-with-label &quot;Hello World&quot;)))

    ;; Connect and decorate the window and button.
    (set-title window &quot;Window&quot;)
    (set-default-size window 200 200)
    (add window button-box)
    (add button-box button)

    ;; Register a procedure as a signal handler to the
    ;; &lt;GtkButton&gt;'s `clicked' signal.
    (connect button print-hello)

    ;; Register a lambda as the signal handler of the
    ;; &lt;GtkButton&gt;'s `clicked' signal.
    (connect button clicked (lambda args (destroy window)))

    ;; Make everything visible.
    (show-all window))

  ;; Note that the `activate' signal callback requires no
  ;; return value.
  )

(define (main)
  ;; Call Gtk's application:new to create a new
  ;; &lt;GtkApplication&gt;
  (let ((app (application:new
              &quot;org.gtk.example&quot;
              ;; Pick a flag from the set of GApplicationFlags
              (list-&gt;application-flags '(flags-none)))))
    ;; Register the procedure `activate-callback' as the
    ;; signal handler for the `activate' signal that the
    ;; &lt;GtkApplication&gt; handles.
    (connect app activate activate-callback)

    ;; Call application:run.  If there are no arguments in
    ;; the command line args, this will send the `activate'
    ;; signal.
    (run app (command-line))))

;; Run the script
(main)
</pre></div>

<p>In the second version, the script is made faster by using <code>require</code>
and <code>load-by-name</code> instead of <code>use-typelibs</code>.  It also prefers
the <code>make</code> syntax to set properties directly, rather than calling
methods one-by-one.
</p>
<div class="example">
<pre class="example">(use-modules (gi) (gi repository))

(require &quot;Gio&quot; &quot;2.0&quot;)
(require &quot;Gtk&quot; &quot;3.0&quot;)

(load-by-name &quot;Gio&quot; &quot;Application&quot;) ;; activate, run
(load-by-name &quot;Gtk&quot; &quot;Application&quot;)
(load-by-name &quot;Gtk&quot; &quot;ApplicationWindow&quot;)
(load-by-name &quot;Gtk&quot; &quot;Button&quot;)
(load-by-name &quot;Gtk&quot; &quot;ButtonBox&quot;)
(load-by-name &quot;Gtk&quot; &quot;Widget&quot;) ;; show-all

(define (print-hello widget)
  (display &quot;Hello World\n&quot;))

(define (activate-callback app)
  (let* ((window (make &lt;GtkApplicationWindow&gt;
                   #:application app
                   #:default-height 200
                   #:default-width 200
                   #:title &quot;Window&quot;))
         (button-box (make &lt;GtkButtonBox&gt; #:parent window))
         (button (make &lt;GtkButton&gt;
                   #:parent button-box
                   #:label &quot;Hello world&quot;)))
    (connect button clicked print-hello)
    (connect button clicked (lambda _ (destroy window)))
    (show-all window)))

(define (main)
  (let ((app (make &lt;GtkApplication&gt; #:application-id &quot;org.gtk.example&quot;)))
    (connect app activate activate-callback)
    (run app (command-line))))

(main)
</pre></div>

<hr>
</div>
</div>
<div class="section" id="Threads-and-Concurrency">
<span id="Threads-and-Concurrency-1"></span><h3 class="section">2.7 Threads and Concurrency</h3>
<span id="index-threads"></span>
<span id="index-concurrency"></span>

<p>While Guile is multi-threaded, applications using Guile-GI are not fully
thread-safe.  Notably, applications using GTK or GLib&rsquo;s main loop need
all rendering and main loop activities to occur in one thread.  Also, all
calls to <code>typelib-load</code> need to be made from the same thread.
</p>
<hr>
</div>
<div class="section" id="Debugging-and-Profiling">
<span id="Debugging-and-Profiling-1"></span><h3 class="section">2.8 Debugging and Profiling</h3>
<span id="index-debugging"></span>
<span id="index-profiling"></span>

<p>Debugging a program that makes use of Guile-GI bindings has some
challenges.  A few notable one are these:
</p><ul>
<li> When parsing a typelib file to generate a binding, some C procedures
and structures will be bound while others lack sufficient information
to be properly bound.
</li><li> For a given function call, the type and number of arguments in the
Guile binding may differ from the type and number of arguments in the
underlying C call.
</li><li> For a given function call, the stack will include a mix of
Guile-managed frames, <code>libffi</code>-generated frames, and an
application&rsquo;s C stack.
</li></ul>

<p>To add some insight about what is happening in the introspection
layer, Guile-GI provides some hook functions for the purposes
of debugging and makes use of GLib&rsquo;s debug logging functionality.
</p>

<hr>
<div class="subsection" id="Debugging-Hooks">
<span id="Debugging-Hooks-1"></span><h4 class="subsection">2.8.1 Debugging Hooks</h4>

<p>Since most GObject-based libraries use an event and callback model,
debugging can be challenging.  Guile-GI provides the ability for the
user to hook into particular events in the introspection layer.
See <a data-manual="guile" href="https://www.gnu.org/software/guile/manual/html_node/Hooks.html#Hooks">Hooks</a> in <cite>The Guile reference manual</cite> to see how to
operate on them.
</p>
<p>The following hooks are defined
</p><dl class="def">
<dt id="index-_0025before_002dfunction_002dhook"><span class="category">Variable: </span><span><strong>%before-function-hook</strong><a href='#index-_0025before_002dfunction_002dhook' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Will be emitted before calling a function with two arguments:
<var>name</var>, a string denoting the name of the called function,
and <var>args</var>, a list of Scheme variables passed to that function.
</p>
<p>Requires Guile 3.0.7 or greater.
</p></dd></dl>

<p>Since the <code>%before-function-hook</code> procedure is called just before
the FFI calls a C function, it would be called within the procedure call
of any procedure created by GObject introspection.
</p>
<dl class="def">
<dt id="index-_0025before_002dcallback_002dhook"><span class="category">Variable: </span><span><strong>%before-callback-hook</strong><a href='#index-_0025before_002dcallback_002dhook' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Will be emitted before invoking a callback with three arguments:
<var>name</var>, a string denoting the name of the callback,
<var>proc</var>, the Scheme procedure that will be called,
and <var>args</var>, a list of Scheme variables passed to that function.
</p>
<p>Requires Guile 3.0.7 or greater.
</p></dd></dl>

<dl class="def">
<dt id="index-_0025before_002dc_002dcallback_002dhook"><span class="category">Variable: </span><span><strong>%before-c-callback-hook</strong><a href='#index-_0025before_002dc_002dcallback_002dhook' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Will be emitted before invoking a C callback with three arguments:
<var>name</var>, a string denoting the name of the callback,
<var>ptr</var>, a pointer to the C function that will be called,
and <var>args</var>, a list of Scheme variables passed to that function.
</p>
<p>Requires Guile 3.0.7 or greater.
</p></dd></dl>

<p>Callbacks are usually called as the result of signals, and the
procedures to be called are expected to match the type of information
the signal emits.  Setting <code>%before-callback-hook</code> and
<code>%before-c-callback-hook</code> may provide clues when debugging signal
events.
</p>
<hr>
</div>
<div class="subsection" id="GLib-Logging">
<span id="GLib-Logging-1"></span><h4 class="subsection">2.8.2 GLib Logging</h4>

<p>GLib provides a logging library whose behavior can be tailored using
environment variables.  GLib&rsquo;s logging library has a concept of
<em>log levels</em>: critical, error, warning, message, info, and debug.
</p>
<p>The <code>G_MESSAGES_DEBUG</code> environment variable may be set to a
space-separated list of <em>log domains</em> for which debug messages
should be printed. Some useful log domains are <code>GuileGI</code> for
Guile-GI messages, <code>dconf</code>, <code>GLib</code>, <code>GLib-GIO</code>, <code>Gdk</code>,
and <code>Gtk</code>.  Also, the special log domain <code>all</code> will print
debug messages from all domains. For more information on how to take
advantage of this logging, see
<a href="https://developer.gnome.org/glib/stable/glib-running.html">https://developer.gnome.org/glib/stable/glib-running.html</a>.
</p>
<p>When <code>G_MESSAGES_DEBUG</code> is set to <code>GuileGI</code> or <code>all</code>, you
will receive <em>a lot</em> of debugging information from any Guile-GI
libraries being used.  To help better filter through all this, a
<code>(gi logging)</code> library provides a pair of alternative loggers.
</p>
<div class="subsubsection" id="Using-the-Port-Logger">
<h4 class="subsubsection">2.8.2.1 Using the Port Logger</h4>

<p>The <code>(gi logging)</code> library provides the <code>install-port-logger!</code>
procedure that sends logging output to a Scheme port and provides
functionality to target specific categories of debug information
</p>
<dl class="def">
<dt id="index-install_002dport_002dlogger_0021"><span class="category">Procedure: </span><span><strong>install-port-logger!</strong> <em>port</em><a href='#index-install_002dport_002dlogger_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Given <var>port</var>, an output port, this procedure installs a GLib
log writer function that outputs to <var>port</var>.
</p>
<p>The default behavior of this GLib log writer is to print critical,
error, and warning messages to the port.
This logger behaves like the default GLib logger &ndash; i.e. it respects
<code>G_MESSAGES_DEBUG</code> &ndash; but in addition to that also reads
<code>GIG_DEBUG</code> for more fine-grained control over the messages
Guile-GI prints to the port.
</p>
<p>Set the <code>GIG_DEBUG</code> environment variable to a list of topics separated
by any delimiter or the specific value <code>all</code>.
</p><ul>
<li> <code>amap</code> prints information about the mapping of function arguments.
</li><li> <code>load</code> prints information &ndash; when libraries are loaded &ndash; on how C
procedures, structs, unions, and objects are bound to Guile.
</li><li> <code>transfers</code> prints information on how C arguments are converted to
Guile objects and vice versa.
</li><li> <code>all</code> prints all the debug information.
</li></ul>

<p>If <code>GIG_DEBUG</code> is not set, only information about function calls
will be output.
</p></dd></dl>

</div>
<div class="subsubsection" id="Using-the-systemd-journal-Logger">
<h4 class="subsubsection">2.8.2.2 Using the systemd journal Logger</h4>

<p>The <code>(gi logging)</code> library provides the <code>install-journal-logger!</code>
procedure.
</p>
<dl class="def">
<dt id="index-install_002djournal_002dlogger_0021"><span class="category">Procedure: </span><span><strong>install-journal-logger!</strong><a href='#index-install_002djournal_002dlogger_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure sets GLib&rsquo;s <code>g_log_writer_journald</code> function
as the current GLib log writer function.
</p></dd></dl>

<p>For distributions that use systemd&rsquo;s journal, the <code>journalctl</code>
command can help filter debug output.  Guile-GI&rsquo;s debug messages
have the message key <code>GIG_DOMAIN</code> which can be used to filter
debug info into general categories.
</p>
</div>
<div class="subsubsection" id="Using-a-custom-logger">
<h4 class="subsubsection">2.8.2.3 Using a custom logger</h4>

<p>The <code>(gi logging)</code> library provides the <code>install-custom-logger!</code>
procedure.
</p>
<dl class="def">
<dt id="index-install_002dcustom_002dlogger_0021"><span class="category">Procedure: </span><span><strong>install-custom-logger!</strong> <em>logger</em><a href='#index-install_002dcustom_002dlogger_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure installs a helper, which will call <var>logger</var>
to do the actual logging, as the GLib log writer function.
</p>
<p>For the call to <var>logger</var>, the <code>GLogField</code> structures used
by GLib internally are translated to keyword arguments.  For that,
the keys are <code>kebab-cased</code> and the values either transformed
into suitable scheme datatypes or left as-is and passed by pointer.
In the latter case, another argument is added for the length of the field,
which takes the same keyword as the first one, but with the suffix <code>-length</code>.
</p>
<p>The currently supported conversions are:
</p><ul>
<li> <code>#:message</code>, the current message as a string,
</li><li> <code>#:priority</code>, a string representation of the log level,
</li><li> <code>#:glib-domain</code>, the log domain as a string,
</li><li> <code>#:gig-domain</code>, the Guile-GI log domain as a string, and
</li><li> <code>#:code-file</code>, <code>#:code-func</code> and <code>#:code-line</code>,
the location from which the log call was made, each as strings.
</li></ul>

<p>The log level is passed as an integer under the keyword <code>#:log-level</code>.
If you&rsquo;ve loaded the GLib typelib before installing the logger, you can transform
that into log level flags by using <code>number-&gt;log-level</code>.
</p>
</dd></dl>

<hr>
</div>
</div>
</div>
<div class="section" id="Application-Deployment">
<span id="Application-Deployment-1"></span><h3 class="section">2.9 Application Deployment</h3>
<span id="index-deployment"></span>

<p>If you write a program in Guile-GI and wish to share it with the world,
you will need to ensure your users have all the prerequisites.
</p>
<span id="index-prerequisites"></span>

<p>At a minimum, Guile-GI scripts will require that users have the
following packages.
</p><ul>
<li> Guile
</li><li> Guile-GI
</li><li> libffi
</li><li> GLib
</li><li> GObject-Introspection aka GIRepository
</li></ul>

<p>And then, of course, a Guile-GI program will additionally require
whatever libraries its uses (GTK, WebKit2) as well as their associated
typelib files.
</p>
<span id="index-directory-structure"></span>

<p>A good layout for an application might be the following, though we can&rsquo;t
discourage you from using any other.
</p><div class="example">
<pre class="example">/path/to/project
|-- doc
|-- data
|   |-- icons
|   |-- various XML files
|   `-- etc.
|-- module
|   |-- project.scm
|   `-- project
|       `-- more Scheme source files
|-- src
|   `-- C source files (optional, when depending on other libraries/non-GI functionality)
|-- test
|   `-- tests
`-- READMEs, ChangeLogs, build system stuff ...
</pre></div>

<p>You should be able to make use of most &ldquo;data APIs&rdquo; (such as GSettings,
GResource, GtkBuilder...), as long as the data files don&rsquo;t need to
reference functionality implemented in your Scheme code.  If you do find
yourself needing some of that, e.g. if you want to write a GtkBuilder
file for a custom class, consider implementing this functionality in C
and exporting it as a typelib instead.
</p>
<hr>
</div>
<div class="section" id="Testing-and-Continuous-Integration">
<span id="Testing-and-Continuous-Integration-1"></span><h3 class="section">2.10 Testing and Continuous Integration</h3>
<span id="index-testing"></span>
<span id="index-continuous-integration"></span>

<p>The distribution does contain a couple of scripts that should enable it
to be built by Travis-CI.  In the root directory, there is a
<code>.travis.yml</code> and a <code>Dockerfile</code> that work together.  The
docker container pulls the latest version of Ubuntu, and the YML file
builds the project and runs <code>make distcheck</code>.
</p>
</div>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Reference-Guide.html#Reference-Guide" accesskey="n" rel="next">Reference Guide</a>, Previous: <a href="Introduction.html#Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="index.html" accesskey="u" rel="up">Guile-GI</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="The-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
